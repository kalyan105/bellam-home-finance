<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bellam Finance Manager - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="login-page">
    <div class="login-container">
        <div class="login-card">
            <div class="logo">
                <h1>ğŸ  Bellam</h1>
                <p class="subtitle">Family Finance Manager</p>
            </div>
            
            <!-- Tab buttons -->
            <div class="auth-tabs">
                <button type="button" class="auth-tab active" id="loginTab">Sign In</button>
                <button type="button" class="auth-tab" id="registerTab">Sign Up</button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginMobile">Mobile Number</label>
                    <input type="tel" id="loginMobile" name="mobile" required autocomplete="tel" placeholder="10-digit mobile number" maxlength="10" pattern="[0-9]{10}">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="loginPassword" name="password" required autocomplete="current-password">
                        <button type="button" class="toggle-password" data-target="loginPassword">
                            <span>ğŸ‘ï¸</span>
                        </button>
                    </div>
                </div>
                
                <div id="loginError" class="error-message"></div>
                
                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
            </form>
            
            <!-- Registration Form -->
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerUsername">Name</label>
                    <input type="text" id="registerUsername" name="username" required autocomplete="off" minlength="3" placeholder="Your name">
                    <small>At least 3 characters</small>
                </div>
                
                <div class="form-group">
                    <label for="registerMobile">Mobile Number</label>
                    <input type="tel" id="registerMobile" name="mobile" required autocomplete="tel" placeholder="10-digit mobile number" maxlength="10" pattern="[0-9]{10}">
                    <small>Enter your 10-digit mobile number (unique ID)</small>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="registerPassword" name="password" required autocomplete="new-password" minlength="6">
                        <button type="button" class="toggle-password" data-target="registerPassword">
                            <span>ğŸ‘ï¸</span>
                        </button>
                    </div>
                    <small>At least 6 characters</small>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="confirmPassword" name="confirmPassword" required autocomplete="new-password" minlength="6">
                        <button type="button" class="toggle-password" data-target="confirmPassword">
                            <span>ğŸ‘ï¸</span>
                        </button>
                    </div>
                </div>
                
                <div id="registerError" class="error-message"></div>
                <div id="registerSuccess" class="success-message"></div>
                
                <button type="submit" class="btn btn-primary btn-block">Create Account</button>
            </form>
            
            <div class="login-footer">
                <p class="hint">Created by Kalyan</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
            clearMessages();
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
            clearMessages();
        });
        
        function clearMessages() {
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('registerError').style.display = 'none';
            document.getElementById('registerSuccess').style.display = 'none';
        }
        
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const icon = this.querySelector('span');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.textContent = 'ğŸ™ˆ';
                } else {
                    passwordInput.type = 'password';
                    icon.textContent = 'ğŸ‘ï¸';
                }
            });
        });
        
        // Check if already logged in
        fetch('/api/check-auth')
            .then(res => res.json())
            .then(data => {
                if (data.authenticated) {
                    window.location.href = '/dashboard.html';
                }
            });

        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const mobile = document.getElementById('loginMobile').value;
            const password = document.getElementById('loginPassword').value;
            const errorMessage = document.getElementById('loginError');
            
            // Validate mobile number
            if (!/^[0-9]{10}$/.test(mobile)) {
                errorMessage.textContent = 'Please enter a valid 10-digit mobile number';
                errorMessage.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ mobile, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    window.location.href = '/dashboard.html';
                } else {
                    errorMessage.textContent = data.error || 'Invalid mobile number or password';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'An error occurred. Please try again.';
                errorMessage.style.display = 'block';
            }
        });
        
        // Registration form submission
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const mobile = document.getElementById('registerMobile').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorMessage = document.getElementById('registerError');
            const successMessage = document.getElementById('registerSuccess');
            
            // Clear previous messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Validate mobile number
            if (!/^[0-9]{10}$/.test(mobile)) {
                errorMessage.textContent = 'Please enter a valid 10-digit mobile number';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Validate password confirmation
            if (password !== confirmPassword) {
                errorMessage.textContent = 'Passwords do not match';
                errorMessage.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, mobile, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    successMessage.textContent = 'Registration successful! Please sign in with your mobile number.';
                    successMessage.style.display = 'block';
                    registerForm.reset();
                    
                    // Switch to login form after 2 seconds
                    setTimeout(() => {
                        loginTab.click();
                    }, 2000);
                } else {
                    errorMessage.textContent = data.error || 'Registration failed';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'An error occurred. Please try again.';
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>
